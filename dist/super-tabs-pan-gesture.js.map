{"version":3,"file":"super-tabs-pan-gesture.js","sourceRoot":"","sources":["../src/super-tabs-pan-gesture.ts"],"names":[],"mappings":"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","sourcesContent":["import { Renderer2 } from '@angular/core';\r\nimport { Platform } from 'ionic-angular';\r\nimport { pointerCoord, PointerCoordinates } from 'ionic-angular/util/dom';\r\n\r\nimport { SuperTabsConfig } from './components/super-tabs';\r\n\r\nexport class SuperTabsPanGesture {\r\n  onMove: (delta: number) => void;\r\n\r\n  onEnd: (shortSwipe: boolean, shortSwipeDelta?: number) => void;\r\n\r\n  private initialCoords: PointerCoordinates;\r\n\r\n  private initialTimestamp: number;\r\n\r\n  private leftThreshold = 0;\r\n\r\n  private rightThreshold = 0;\r\n\r\n  private shouldCapture: boolean;\r\n\r\n  private isDragging: boolean;\r\n\r\n  private lastPosX: number;\r\n\r\n  private listeners: Function[] = [];\r\n\r\n  constructor(\r\n    private plt: Platform,\r\n    private config: SuperTabsConfig,\r\n    el: HTMLElement,\r\n    rnd: Renderer2\r\n  ) {\r\n    this.listeners.push(\r\n      rnd.listen(el, 'touchstart', this._onStart.bind(this)),\r\n      rnd.listen(el, 'touchmove', this._onMove.bind(this)),\r\n      rnd.listen(el, 'touchend', this._onEnd.bind(this))\r\n    );\r\n\r\n    if (config.sideMenu === 'both' || config.sideMenu === 'left') {\r\n      this.leftThreshold = config.sideMenuThreshold;\r\n    }\r\n\r\n    if (config.sideMenu === 'both' || config.sideMenu === 'right') {\r\n      this.rightThreshold = config.sideMenuThreshold;\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.listeners.forEach(fn => fn());\r\n  }\r\n\r\n  private _onStart(ev: TouchEvent) {\r\n    // check avoid this element\r\n    let avoid = false;\r\n    let element: any = ev.target;\r\n    if (element) {\r\n      do {\r\n        if (element.getAttribute && element.getAttribute('avoid-super-tabs')) {\r\n          avoid = true;\r\n        }\r\n        element = element.parentElement;\r\n      } while (element && !avoid);\r\n    }\r\n\r\n    if (avoid) {\r\n      this.shouldCapture = false;\r\n      return;\r\n    }\r\n\r\n    const coords: PointerCoordinates = pointerCoord(ev),\r\n      vw = this.plt.width();\r\n\r\n    if (coords.x < this.leftThreshold || coords.x > vw - this.rightThreshold) {\r\n      // ignore this gesture, it started in the side menu touch zone\r\n      this.shouldCapture = false;\r\n      return;\r\n    }\r\n\r\n    // the starting point looks good, let's see what happens when we move\r\n\r\n    this.initialCoords = coords;\r\n    if (this.config.shortSwipeDuration > 0) {\r\n      this.initialTimestamp = Date.now();\r\n    }\r\n    this.lastPosX = coords.x;\r\n  }\r\n\r\n  private _onMove(ev: TouchEvent) {\r\n    const coords: PointerCoordinates = pointerCoord(ev);\r\n\r\n    if (!this.isDragging) {\r\n      if (typeof this.shouldCapture !== 'boolean') {\r\n        // we haven't decided yet if we want to capture this gesture\r\n        this.checkGesture(coords);\r\n      }\r\n\r\n      if (this.shouldCapture === true) {\r\n        // gesture is good, let's capture all next onTouchMove events\r\n        this.isDragging = true;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n\r\n    // stop anything else from capturing these events, to make sure the content doesn't slide\r\n    if (this.config.allowElementScroll !== true) {\r\n      ev.stopPropagation();\r\n      ev.preventDefault();\r\n    }\r\n\r\n    // get delta X\r\n    const deltaX: number = this.lastPosX - coords.x;\r\n\r\n    // emit value\r\n    this.onMove && this.onMove(deltaX);\r\n\r\n    // update last X value\r\n    this.lastPosX = coords.x;\r\n  }\r\n\r\n  private _onEnd(ev: TouchEvent) {\r\n    const coords: PointerCoordinates = pointerCoord(ev);\r\n\r\n    if (this.shouldCapture === true) {\r\n      if (this.config.shortSwipeDuration > 0) {\r\n        const deltaTime: number = Date.now() - this.initialTimestamp;\r\n\r\n        if (deltaTime <= this.config.shortSwipeDuration) {\r\n          this.onEnd && this.onEnd(true, coords.x - this.initialCoords.x);\r\n        } else {\r\n          this.onEnd && this.onEnd(false);\r\n        }\r\n      } else {\r\n        this.onEnd && this.onEnd(false);\r\n      }\r\n    }\r\n\r\n    this.isDragging = false;\r\n    this.shouldCapture = undefined;\r\n  }\r\n\r\n  private checkGesture(newCoords: PointerCoordinates) {\r\n    if (!this.initialCoords) {\r\n      return;\r\n    }\r\n\r\n    const radians = this.config.maxDragAngle * (Math.PI / 180),\r\n      maxCosine = Math.cos(radians),\r\n      deltaX = newCoords.x - this.initialCoords.x,\r\n      deltaY = newCoords.y - this.initialCoords.y,\r\n      distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n\r\n    if (distance >= this.config.dragThreshold) {\r\n      // swipe is long enough so far\r\n      // lets check the angle\r\n      const angle = Math.atan2(deltaY, deltaX),\r\n        cosine = Math.cos(angle);\r\n\r\n      this.shouldCapture = Math.abs(cosine) > maxCosine;\r\n    }\r\n  }\r\n}\r\n"]}